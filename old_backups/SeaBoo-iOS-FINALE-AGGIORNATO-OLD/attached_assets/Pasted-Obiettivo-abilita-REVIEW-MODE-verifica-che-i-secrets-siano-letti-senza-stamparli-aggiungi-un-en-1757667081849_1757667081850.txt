Obiettivo: abilita REVIEW_MODE, verifica che i secrets siano letti (senza stamparli), aggiungi un endpoint di self-check e conferma che login Apple e pagamenti mock siano operativi.

Imposta/controlla i Secrets

REVIEW_MODE=true

APPLE_CLIENT_ID (o BUNDLE_ID)

(se ce l’hai) APPLE_SHARED_SECRET — non stamparne mai il valore

Server: aggiungi endpoint di self-check (in index.js/server.js). Crea/aggiorna questo blocco:

// ---- REVIEW TOGGLE & SAFE CHECK ----
const REVIEW_MODE = process.env.REVIEW_MODE === 'true';
function safeFlag(name, present) { return { name, present: !!present }; }

app.get('/review/info', (_req, res) => {
  res.json({
    ok: true,
    reviewMode: REVIEW_MODE,
    env: [
      safeFlag('APPLE_CLIENT_ID', !!process.env.APPLE_CLIENT_ID),
      safeFlag('BUNDLE_ID',       !!process.env.BUNDLE_ID),
      safeFlag('APPLE_SHARED_SECRET', !!process.env.APPLE_SHARED_SECRET)
    ],
    services: {
      support: true,
      siwa: true,
      iap: true,
      payments: true
    }
  });
});

// Health già presenti? In caso contrario assicurati che esistano:
app.get('/auth/apple/health', (_req, res) => res.json({ ok:true, service:'apple-login' }));
app.get('/iap/health',        (_req, res) => res.json({ ok:true, service:'iap' }));
app.get('/payments/health',   (_req, res) => res.json({ ok:true, reviewMode: REVIEW_MODE }));
app.get('/health',            (_req, res) => res.json({ ok:true }));


Assicurati che i middleware ci siano una sola volta (evita duplicati):

const morgan = require('morgan');
app.use(morgan('combined'));
app.use(express.json({ limit: '1mb' }));


Riavvia il server e verifica questi URL (devono rispondere 200 con ok:true):

GET /supporto (pagina di supporto)

GET /auth/apple/health

GET /iap/health (anche se non usiamo abbonamenti, deve rispondere)

GET /payments/health (mostra reviewMode: true)

GET /review/info (controlla che present:true per le variabili impostate)

Test rapidi API pagamenti in review mode

POST /bookings/create con JSON di esempio:

{
  "boatId": "demo-boat-1",
  "startDate": "2025-09-20",
  "endDate": "2025-09-21",
  "amount": 15000,
  "currency": "EUR"
}


Deve tornare ok:true e paymentStatus:"paid_demo".

Stampa un log sintetico “READY” a riavvio completato (senza valori di secrets):

console.log('[SeaBoo] READY | reviewMode=', REVIEW_MODE,
  '| APPLE_CLIENT_ID:', !!process.env.APPLE_CLIENT_ID,
  '| BUNDLE_ID:', !!process.env.BUNDLE_ID);


Conferma in console che non vengono mai loggati i valori reali dei secrets.